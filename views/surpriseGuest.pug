extends layout

mixin getActions(step)
  - var i = 0;
  - options = '';
  while i < step.length
    if i > 0
      - options += '<br>'
    - option = step[i].item ? step[i].item : (step[i].action + (step[i].part ? ' ' + step[i].part : ''));
    if option instanceof Array
      - option = option.join('<br>')
    - option = option.charAt(0).toUpperCase() + option.slice(1);
    - options += option;
    - i++;
  td.align-middle !{options}

block content
  .container
    .row.mb-4
      .col-12
        h1.text-primary.pb-2(style="border-bottom: 2px solid; border-color: #8d6fe2;") Surprise Guest Interactions
      .col-12.mt-2
        .card.card-body.shadow.rounded
          .lineHeader.h5.text-primary Settings
          #settings.mx-auto.collapse.hide
            .custom-control.custom-radio.custom-control-inline.text-center
              input.custom-control-input(type="radio" id="shortActions" name="optionsSwitch")
              label.custom-control-label(for="shortActions") Show one option for each action
            .custom-control.custom-radio.custom-control-inline.text-center
              input.custom-control-input(type="radio" id="allActions" name="optionsSwitch")
              label.custom-control-label(for="allActions") Show alternative options
            .custom-control.custom-checkbox.mt-2.mb-1.text-center
              input.custom-control-input(type="checkbox" id="useItems")
              label.custom-control-label(for="useItems") Use items
          .text-center
            a(class="text-secondary" id="settingsCollapser" data-toggle="collapse" href="#settings" role="button" aria-expanded="false" aria-controls="settings")
              |
              |
              <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-chevron-up chevron" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 5.707l-5.646 5.647a.5.5 0 0 1-.708-.708l6-6z"/></svg>


      .col-12.my-2
        .card.card-body.shadow.rounded
          .row
            .col-3
              .nav.flex-column.nav-pills.mb-2(role='tablist' aria-orientation="vertical")
                each interaction, i in interactions
                  a(class='nav-item nav-link'+(i===0?' active':'') id=interaction.chara+'Pill' data-toggle='pill' href='#'+interaction.chara role='tab' aria-controls=interaction.chara aria-selected="true")
                    span
                      img.img-fluid.mx-1(src=`/images/faces/${interaction.chara}.png` style='max-width: 30px; width:100%;')
                      | #{interaction.chara}
            .col-9
              .tab-content
                each interaction, i in interactions
                  div(class="tab-pane fade"+(i===0?" show active":"") id=interaction.chara role='tabpanel' aria-labelledby=interaction.chara+'Pill')
                    each meet in interaction.interactions
                      table.table
                        thead.text-primary
                          tr
                            th.bg-secondary.text-white.border-secondary(colspan='4')
                              .row.w-100.align-items-center.mx-0
                                .col-10.text-left.px-0.h5.align-middle.mb-0
                                  | #{meet.phrase}
                                .col-2.text-right.px-0.h6.align-middle.mb-0
                                  | #{meet.condition}
                        tbody
                          tr.text-primary.text-center
                            th.h6(style='width: 30%') Action 1
                            th.h6(style='width: 30%') Action 2
                            th.h6(style='width: 30%') Action 3
                            th.h6(style='width: 10%') Points
                          tr.text-dark.text-center.moves
                            +getActions(meet.allInteractions.first)
                            +getActions(meet.allInteractions.second)
                            +getActions(meet.allInteractions.third)
                            td.align-middle +#{meet.allInteractions.points}
                          tr.text-dark.text-center.movesShort
                            +getActions([meet.allInteractionsShort.first])
                            +getActions([meet.allInteractionsShort.second])
                            +getActions([meet.allInteractionsShort.third])
                            td.align-middle +#{meet.allInteractionsShort.points}
                          if meet.itemInteractions
                            tr.text-dark.text-center.items
                              +getActions(meet.itemInteractions.first)
                              +getActions(meet.itemInteractions.second)
                              +getActions(meet.itemInteractions.third)
                              td.align-middle +#{meet.itemInteractions.points}
                          if meet.itemInteractionsShort
                            tr.text-dark.text-center.itemsShort
                              +getActions([meet.itemInteractionsShort.first])
                              +getActions([meet.itemInteractionsShort.second])
                              +getActions([meet.itemInteractionsShort.third])
                              td.align-middle +#{meet.itemInteractionsShort.points}

  style.
    .nav-pills .nav-item.active:not(:last-child) {
      border-bottom: 1px solid var(--primary);
    }
    .nav-pills .nav-item:not(.active):not(:last-child) {
      border-bottom: 1px solid #dee2e6;
      border-radius: 0;
    }
    *[aria-expanded="false"]>.chevron {
      transform: scaleY(-1);
    }
  script(src="/javascripts/surpriseGuestFunctions.js")
