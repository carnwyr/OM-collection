extends layout

block scripts
  link(rel="stylesheet" href="/stylesheets/cardDetail.css")
  script.
    var i18next = { "collected_count": "#{t("cards.collected_count", { percentage: "undefined" })}", "favourite_count": "!{t("cards.favourite_count", { percentage: "undefined" })}" };
    const CARD_NAME = !{JSON.stringify(card.uniqueName)};

block content
  div.container
    h1= title
    if user
      div#alert(role="alert")
      if !isHidden
        div.d-flex.align-items-center.justify-content-between.mb-3.d-md-none
          button.btn.btn-primary.owned(type="button") collection
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="white" stroke="black" class="bi bi-star-fill favourites" viewBox="0 0 16 16"><path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.283.95l-3.523 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/></svg>
    div.card-container
      if card.type === "Demon"
        div.w-50.pr-1.pr-md-0
          h5 Original
          a(href="/images/cards/L/" + card.uniqueName + ".jpg")
            img.img-fluid.shadow(src="/images/cards/L/" + card.uniqueName + ".jpg")
        div.w-50.pl-1.pr-md-0
          h5 Bloomed
          a(href="/images/cards/L/" + card.uniqueName + "_b.jpg")
            img.img-fluid.shadow(src="/images/cards/L/" + card.uniqueName + "_b.jpg")
      else
        div#memory
          a(href="/images/cards/L/" + card.uniqueName + ".jpg")
            img.img-fluid.shadow(src="/images/cards/L/" + card.uniqueName + ".jpg")

    div.card.mb-3
      div.card-body
        table
          tr
            th= t("cards.type")
            td= t("cards."+card.type)
            th= t("cards.rarity")
            td: a(href="/cards?rarity="+card.rarity.replace('+', 'p'))= card.rarity
          tr
            th= t("cards.attribute")
            td: a(href="/cards?attribute="+card.attribute)= t(card.attribute)
            th= card.characters.length>1?t("cards.characters"):t("cards.character")
            td
              each val, index in card.characters
                a(href="/cards?character="+(val==="Little D"?"LittleD":val))= t(val)
                if index < card.characters.length - 1
                  | ,
                  |
          tr
            th= t("cards.source")
            td
              each val, index in card.source
                a(href="/event/"+card.source_link[index])= val
                if index < card.source.length - 1
                  | ,
                  |
          
        //- p #[strong #{t("cards.type")}:] #{t("cards."+card.type)}
        //- p #[strong #{t("cards.rarity")}: ]
        //-   a(href="/cards?rarity="+card.rarity.replace('+', 'p'))= card.rarity
        //- p #[strong #{t("cards.attribute")}: ]
        //-   a(href="/cards?attribute="+card.attribute)= t(card.attribute)
        //- p #[strong #{card.characters.length>1?t("cards.characters"):t("cards.character")}: ]
        //-   each val, index in card.characters
        //-     a(href="/cards?character="+(val==="Little D"?"LittleD":val))= t(val)
        //-     if index < card.characters.length - 1
        //-       | ,
        //-       |
        //- p #[strong #{t("cards.source")}: ]
        //-   each val, index in card.source
        //-     a(href="/event/"+card.source_link[index])= val
        //-     if index < card.source.length - 1
        //-       | ,
        //-       |
        hr
        if !isHidden
          p.ownedCount= t("cards.collected_count", { percentage: stats.ownedTotal })
          p.favedCount !{t("cards.favourite_count", { percentage: stats.favedTotal })}
        if user && !isHidden
          hr
          div.d-flex.align-items-center.justify-content-between
            button.btn.btn-primary.owned(type="button") collection
            <svg id="star" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="white" stroke="black" class="bi bi-star-fill favourites" viewBox="0 0 16 16"><path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.283.95l-3.523 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/></svg>
        if !isHidden
          hr
          div.mt-2: a.btn.btn-primary(role="button" href=card.uniqueName+"/edit") Edit card
        if user && user.isAdmin
          if isHidden
            div.mt-2: a.btn.btn-primary(role="button" href=card.uniqueName+"/makePublic") Make public
          div.mt-2: button.btn.btn-primary(data-toggle='modal' data-target="#confirmDelete") Delete card
    
    div.card.mb-3
      div.card-body
        h5.card-title Strength
        div.table-responsive
          table.table
    
    //- div.card.mb-3
    //-   div.card-body
    //-     h5.card-title Skills

  if user && !isHidden
    style.
      .owned.addCardButton:before {
        content: "Add to ";
      }
      .owned.removeCardButton:before {
        content: "Remove from ";
      }
      .favourites.removeCardButton {
        stroke: #FFC300;
        fill: #FFC300;
      }
    script(src="/javascripts/cardDetailFunctions.js")
    script.
      var stats = !{JSON.stringify(stats)};

  if user && user.isAdmin
    div(class="modal fade" id="confirmDelete" tabindex="-1" role="dialog" aria-labelledby="confirmDeleteLabel" aria-hidden="true")
      div(class="modal-dialog" role="document")
        div(class="modal-content")
          div(class="modal-body")
            p Are you sure you want to delete this card?
            p#result.alert
          div(class="modal-footer")
            button.btn.btn-danger(onclick="deleteCard()") Delete
            button.btn.btn-secondary(data-dismiss="modal") Cancel
    script.
      function deleteCard() {
        $.post("delete", { card: CARD_NAME }, function(result) {
          if (result.success) {
            $("#result").addClass("alert-success").text("Card deleted. Please refresh page.")
          } else {
            $("#result").addClass("alert-danger").text(JSON.stringify(result));
          }
        });
      }
