extends layout

block scripts
	link(rel="stylesheet" href="/stylesheets/eventEdit.css")
	script(src="/javascripts/eventEdit.js")
	link(href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css" rel="stylesheet")
	script(src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js")
	script.
		var apPresets = !{JSON.stringify(apPresets)};

mixin rewardEntry(reward = {tag:null, points:null, card:null})
	form.form-inline
		select.custom-select.form-control.tag-select(name="tag" placeholder="Reward tag")
			each option in rewardOptions
				option(value=option selected=checkSelectedTag(option, reward.tag))= option
			option(value='' selected=checkSelectedTag('Custom', reward.tag)) Custom
		input.form-control.d-none(type="text" placeholder="Custom reward tag" name="customTag" value=reward.tag)
		input.form-control(type="number" placeholder="Reward cost" name="points" value=reward.points)
		select.card-select.form-control.custom-select.mb-0(name="card" placeholder="Card (if applicable)")
			option(value='' data-subtext='None')
			each card in cardData
				option(value=card selected= reward.card===card)= card
		button.btn.btn-outline-secondary.remove-button(type="button") Remove

mixin apEntry(ap = {amount:null, points:null, page:null})
	form.form-inline
		input.form-control(type="number" placeholder="AP amount" name="amount" value=ap.amount)
		input.form-control(type="number" placeholder="AP cost" name="points" value=ap.points)
		input.form-control(type="number" placeholder="Part _ only" name="page" value=ap.page)
		button.btn.btn-outline-secondary.remove-button(type="button") Remove

block content
	include mixins/imageUpload
	-
		var rewardOptions = ['Demon SSR', 'Memory SSR', 'Memory UR', 'Demon UR'];
		function checkSelectedTag(optionTag, rewardTag) {
			if (rewardOptions.includes(rewardTag)) {
				return rewardTag === optionTag;
			}
			if (!rewardTag) {
				return optionTag === 'Demon SSR';
			}
			return optionTag === 'Custom';
		}
	div#alert(role="alert")
	div.container
		h1= title
		div.card.shadow
			div.card-body
				h5 Event Info
				hr.mt-0
				form#info
					div.form-row
						div.col-12.col-md-4
							div.form-group
								label(for="en-name") Name
								input.form-control(id="en-name" type="text" name="en-name" value=data.name.en)
						div.col-12.col-md-4
							div.form-group
								label(for="ja-name") Japanese name
								input.form-control(id="ja-name" type="text" name="ja-name" value=data.name.ja)
						div.col-12.col-md-4
							div.form-group
								label(for="zh-name") Chinese name
								input.form-control(id="zh-name" type="text" name="zh-name" value=data.name.zh)
					div.form-row
						div.col-12.col-md-4
							div.form-group
								label(for="type") Type
								select#eventType(class='custom-select' name="type")
									option(value='Pop Quiz' selected=(data.type==='Pop Quiz')) Pop Quiz
									option(value='Lonely Devil' selected=(data.type==='Lonely Devil')) Lonely Devil
									option(value='Birthday' selected=(data.type==='Birthday')) Birthday
									option(value='Nightmare' selected=(data.type==='Nightmare')) Nightmare
						div.col-12.col-md-8.col-lg-4
							div.form-row
								div.col-6.form-group
									label(for="stages") Number of stages
									input#stages.form-control(type="number" name="stages" value=data.stages)
								div.col-6.form-group
									label(for="pageCost") Page cost
									input#pageCost.form-control(type="number" name="pageCost" value=data.pageCost)
					div.form-row
						div.col-6.col-md-4.form-group
							label(for="start") Start date (UTC)
							input#start.form-control(type="text" name="start" value=data.start)
						div.col-6.col-md-4.form-group
							label(for="end") End date (UTC)
							input#end.form-control(type="text" name="end" value=data.end)

						div.col-12.col-lg-8.px-3.mt-4.mb-3
							+uploadImage("Event image", data ? "/images/events/" + data.name.en + ".jpg" : "#")

				br
				h5 Rewards
				hr.mt-0
				div#rewards
					if data.rewards && data.rewards.length !== 0
						each reward in data.rewards
							+rewardEntry(reward)
					else
						+rewardEntry()
				button#addReward.btn.btn-secondary.mb-4(data-target="#rewards" data-clone="#rewardTemplate") Add reward
				br
				br
				h5 AP Rewards
				hr.mt-0
				div.dropdown.mb-3
					button.btn.btn-secondary.dropdown-toggle#APpresets(type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false") Presets
					div.dropdown-menu.shadow(aria-labelledby="APpresets")
						each [key, value] of Object.entries(apPresets)
							button.dropdown-item.preset(type="button" value=key)= key
					small.text-muted.align-middle.ml-2.pt-2 Actual rewards often differ from the presets
				div#AP
					if data.ap && data.ap.length !== 0
						each ap in data.ap
							+apEntry(ap)
					else
						+apEntry()
				button#addAP.btn.btn-secondary.mb-2(data-target="#AP" data-clone="#APTemplate") Add AP reward
				br
				br
				button#submit.btn.btn-primary.float-right Submit Change

			template#rewardTemplate
				+rewardEntry()

			template#APTemplate
				+apEntry()
