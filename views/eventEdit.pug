extends layout

block scripts
	link(rel="stylesheet" href="/stylesheets/eventEdit.css")
	script(src="/javascripts/eventEdit.js")

mixin rewardEntry(reward = {tag:null, points:null, card:null})
	form.form-inline
		select.custom-select.form-control(name="tag" placeholder="Reward tag")
			each option in rewardOptions
				option(value=option selected=checkSelectedTag(option, reward.tag))= option
			option(value='' selected=checkSelectedTag('Custom', reward.tag)) Custom
		input.form-control.d-none(type="text" placeholder="Custom reward tag" name="customTag" value=reward.tag)
		input.form-control(type="number" placeholder="Reward cost" name="points" value=reward.points)
		input.form-control(type="text" placeholder="Card (if applicable)" name="card" value=reward.card)
		button.btn.btn-outline-secondary(type="button") Remove

block content
	include mixins/imageUpload
	-
		var rewardOptions = ['Demon SSR', 'Memory SSR', 'Memory UR', 'Demon UR'];
		function checkSelectedTag(optionTag, rewardTag) {
			if (rewardOptions.includes(rewardTag)) {
				return rewardTag === optionTag;
			}
			if (!rewardTag) {
				return optionTag === 'Demon SSR';
			}
			return optionTag === 'Custom';
		}
	div#alert(role="alert")
	div.container
		h1= title
		div.card.shadow
			div.card-body
				h5 Event Info
				form#info
					div.form-row
						div.col-4
							div.form-group
								label(for="name") Name
								input#name.form-control(type="text" name="name" value=data.name)
							div.form-group
								label(for="ja_name") Japanese name
								input#ja_name.form-control(type="text" name="ja_name" value=data.ja_name)
							div.form-group
								label(for="uniqueName") Unique name
								input#uniqueName.form-control(type="text" name="uniqueName" value=data.uniqueName)

						div.col-4
							div.form-group
								label(for="start") Start date (UTC)
								input#start.form-control(type="text" name="start" value=data.start)
							div.form-group
								label(for="stages") Number of stages
								input#stages.form-control(type="number" name="stages" value=data.stages)
							div.form-group
								label(for="pageCost") Page cost
								input#pageCost.form-control(type="number" name="pageCost" value=data.pageCost)
						div.col-4
							div.form-group
								label(for="end") End date (UTC)
								input#end.form-control(type="text" name="end" value=data.end)

							div.form-group
								label(for="type") Type
								select#eventType(class='custom-select' name="type")
									option(value='Pop Quiz' selected=(data.type==='Pop Quiz')) Pop Quiz
									option(value='Lonely Devil' selected=(data.type==='Lonely Devil')) Lonely Devil
									option(value='Birthday' selected=(data.type==='Birthday')) Birthday
									option(value='Nightmare' selected=(data.type==='Nightmare')) Nightmare

						.col-8.px-3.mt-4.mb-3
							+uploadImage("Event image", data ? "/images/events/" + data.uniqueName + ".jpg" : "#")

				br
				h5 Rewards
				div#rewards
					if data.rewards && data.rewards.length !== 0
						each reward in data.rewards
							+rewardEntry(reward)
					else
						+rewardEntry()
				button#addReward.btn.btn-secondary.mb-4(data-target="#rewards" data-clone="#rewardTemplate") Add reward
				br
				br
				h5 AP Rewards
					small.ml-2 Please remove empty rows before updating event
				form#AP
					if data.ap && data.ap.length !== 0
						each ap in data.ap
							div.form-inline
								input.form-control(type="number" placeholder="AP amount" name="amount" value=ap.amount)
								input.form-control(type="number" placeholder="AP cost" name="points" value=ap.points)
								input.form-control(type="number" placeholder="page (if non-repeating)" name="page" value=ap.page)
								button.btn.btn-outline-secondary(type="button") Remove
					else
						div.form-inline
							input.form-control(type="number" placeholder="AP amount" name="amount")
							input.form-control(type="number" placeholder="AP cost" name="points")
							input.form-control(type="number" placeholder="page (if non-repeating)" name="page")
							button.btn.btn-outline-secondary(type="button") Remove
				hr
				button#addAP.btn.btn-secondary(data-target="#AP" data-clone="#APTemplate") Add AP reward
				br
				br
				button#submit.btn.btn-primary Submit Change

			template#rewardTemplate
				+rewardEntry()

			template#APTemplate
				div.form-inline
					input.form-control(type="number" placeholder="AP amount" name="amount")
					input.form-control(type="number" placeholder="AP cost" name="points")
					input.form-control(type="number" placeholder="available page" name="page")
					button.btn.btn-outline-secondary(type="button") Remove
