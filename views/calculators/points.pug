extends ../layout

block scripts
  script.
    const POPQUIZ = !{JSON.stringify(data)};
    const DAILY_FREE_BATTLES = POPQUIZ.stages * 3;
    const DAILY_FREE_AP = 288 + 20 * 2 + 10 * 3 + 30 * 2;
  script(src="/javascripts/calculator.js")

block content
  -
    function started() {
      return new Date() > new Date(data.start);
    }
    function ended() {
      return new Date() > new Date(data.end);
    }
  div.container
    h1= title
    div.card.card-body.mb-3
      a.h5.text-center.m-0(href="#collapseinfo" data-toggle="collapse" role="button" aria-expanded="false" aria-controls="collapseinfo") Information
        |
        |
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-up" viewBox="0 0 16 16">   <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 5.707l-5.646 5.647a.5.5 0 0 1-.708-.708l6-6z"/> </svg>
      div#collapseinfo.collapse
        h5.card-title A few things about how it works
        span.card-text This calculator:
        ul
          li always round up its calculation.
          li can only be as accurate as your input.
          li currently do not support boosting periods.
        h5.card-title Assumptions
        span.card-text This calculator assumes that:
        ul
          li you get three-stars on every battle.
          li you have not cleared today's free battles.
        h5.text-center.m-0 Please use your own calculation if you believe Karasu's results are wrong!
    div.card
      div.card-body
        div.row
          div#pqinfo.col-12.col-md-4.text-center
            h5= t("lang") === "ja" ? data.name.ja : data.name.en
            a(href="/event/" + getURL(data.name.en)): img.img-fluid.rounded.mb-3(src="/images/events/" + encodeURIComponent(data.name.en) + ".jpg" onerror="this.onerror=null;this.src='/images/event_placeholder.jpg'")
            if started()
              p Ending in
            else
              p Starting in
            h5#cd.mb-3 --
            if data.hasBoosting
              - let dateNow = new Date();
              if dateNow < data.boostingStart
                p Boosting starting in
                h5#boostingcd --
              else if dateNow < data.boostingEnd
                p Boosting ending in
                h5#boostingcd --
              else
                p Boosting has ended.
            hr.d-md-none
          div.col-12.col-md-8
            form#calculator
              div.form-row
                div.form-group.col-12.col-md-4
                  label Goal
                  input.form-control(type="number" min=0 name="goal")
                div.form-group.col-12.col-md-4
                  label Current points
                  input.form-control(type="number" min=0 name="currpts")
                div.form-group.col-12.col-md-4
                  label Points per battle
                  input.form-control(type="number" name="ppb" readonly=data.isBirthday min=(data.isBirthday?12:120) value=(data.isBirthday?12:''))
            //-
              if data.rewardListType == "boxes"
                p You need #{} points at most to clear each box.
            <ul class="nav nav-tabs" id="resultTab" role="tablist">
              <li class="nav-item" role="presentation">
                <a class="nav-link active" id="overview-tab" data-toggle="tab" href="#overview" role="tab" aria-controls="overview" aria-selected="true">Overview</a>
              </li>
              <li class="nav-item" role="presentation">
                <a class="nav-link" id="daily-tab" data-toggle="tab" href="#daily" role="tab" aria-controls="daily" aria-selected="false">Today</a>
              </li>
            </ul>
            div#resultTabContent.tab-content.pt-3
              div#overview.tab-pane.show.active(role="tabpanel" aria-labelledby="overview-tab")
                p.text-center You can get a total of
                  |
                  |
                  span#freepts.h5 --
                  |
                  | points for free
                  a(href="#note1") *
                  | .
                p.text-center An additional
                  |
                  |
                  span#additionalpts.h5 --
                  |
                  | points is needed to reach your goal.
                hr
                //-
                  if data.hasBoosting
                    p If you get additional points during boosting, you will need:
                    ul#overview-boosting
                      li AP: --
                      li Battles: --
                p Getting additional points during regular (no boosting) event time will require at least:
                ul#overview-regular
                  li AP:
                    |
                    |
                    span.ap --
                  li Battles:
                    |
                    |
                    span.battle --

              div#daily.tab-pane(role="tabpanel" aria-labelledby="daily-tab")
                div.text-center
                  p Today's goal
                  h5#goal --
                h5 Breakdown
                div#results.row.justify-content-center
                  div.col-12.col-md-6.col-lg-4
                    div.result-container
                      p AP
                      div
                        div
                          p.mb-0= t("calculator.free")
                          span#freeap --
                        div
                          p.mb-0= t("calculator.buy")
                          span#buyap --
                        hr
                        div
                          p.mb-0 Total
                          span#aptot --
                  div.col-12.col-md-6.col-lg-4
                    div.result-container
                      p Battles
                      div
                        div
                          p.mb-0= t("calculator.free")
                          span#freebattles --
                        div
                          p.mb-0= t("calculator.buy")
                          span#buybattles --
                        hr
                        div
                          p.mb-0 Total
                          span#battlestot --
                  div.col-12.col-md-6.col-lg-4
                    div.result-container
                      p Devil Points
                      div
                        div
                          p.mb-0 AP
                          span#apcost --
                        div
                          p.mb-0 Battles
                          span#battlescost --
                        hr
                        div
                          p.mb-0 Total
                          span#totcost --
                //-
                  small.text-muted.text-center If you saved some AP and D-Energy, then you can use the
                    |
                    |
                    a(href='') akuzon calculator
                    |
                    | to find out how much less DP you need.
      if !started()
        div.w-100.h-100.rounded(style="position:absolute;background:rgba(255,255,255,.8);")
          div.row.w-100.h-100.justify-content-center.align-items-center
            h5 Coming soon.
      if ended()
        div.w-100.h-100.rounded(style="position:absolute;background:rgba(255,255,255,.8);")
          div.row.w-100.h-100.justify-content-center.align-items-center
            h5 This event has ended.
    div.card.card-body.mt-3
      p#note1 *Free points means the final amount of points you will have if you clear all free battles from now until the end of pop quiz, without spending a single DP/D-Energy on battles. If you do not want to spend anything on this pop quiz, then you can still get
        |
        |
        span#absfree --
        |
        | points for absoluately free.
      h5.card-title Tips
      ul
        li If you have remaining battles and AP, use them all up before the next day begins.
        li Always purchase the daily flash sale that only cost 10 DP! If you purchase the flash sale, then you will need less DP than the calculated result.

  style.
    #results p {
      text-align: center;
    }
    #results .result-container {
      border-radius: 1rem;
      border: 2px solid var(--secondary);
      padding: 1rem 1.5rem;
      margin-bottom: 1rem;
    }
    #results .result-container>div>div {
      display: flex;
      justify-content: space-between;
    }
    #results hr {
      margin: .5rem 0;
      border: 1px solid var(--secondary);
    }

    @media (min-width: 768px) {
      #pqinfo {
        border-right:1px solid #e5e5e5;
      }
    }
    a[data-toggle="collapse"][aria-expanded="false"] .bi.bi-chevron-up {
      transform: rotate(180deg);
    }
