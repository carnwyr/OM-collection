extends ../layout

block scripts
  script(src="/javascripts/calculator1.js")
  script.
    const END_DATE = !{JSON.stringify(data.end)};
    const TOTAL_STAGES = 26;
    const DAILY_FREE_AP = 288;
    const DAILY_FREE_BATTLES = TOTAL_STAGES * 3;

block content
  -
    function started() {
      return new Date() > new Date(data.start);
    }
    function ended() {
      return new Date() > new Date(data.end);
    }
  div.container
    h1= title
    div.card.card-body.mb-3
      a.h5.text-center.m-0(href="#collapseinfo" data-toggle="collapse" role="button" aria-expanded="false" aria-controls="collapseinfo") Information
        |
        |
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-up" viewBox="0 0 16 16">   <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 5.707l-5.646 5.647a.5.5 0 0 1-.708-.708l6-6z"/> </svg>
      div#collapseinfo.collapse
        h5.card-title A few things about how it works
        span.card-text This calculator:
        ul
          li always round up in calculation.
          li can only be as accurate as your input.
          li evenly spreads necessary battles throughout remaining days. Even if you can complete the goal today with free battles, it will still divide remaining battles among remaining days.
          li currently do not support boosting periods. Please be careful when using during those times.
          li have a higher chance of making mistakes until you unlock all stages with keys.
        h5.card-title Assumptions
        span.card-text This calculator assumes that:
        ul
          li you get three-stars on every battle.
          li you have not cleared today's free battles.
        h5.text-center.m-0 Please use your own calculation if you believe Karasu's results are wrong!
    div.card
      div.card-body
        div.row
          div#pqinfo.col-12.col-md-4.text-center
            h5= t("lang") === "ja" ? data.name.ja : data.name.en
            a(href="/event/" + getURL(data.name.en)): img.img-fluid.rounded.mb-3(src="/images/events/" + encodeURIComponent(data.name.en) + ".jpg" onerror="this.onerror=null;this.src='/images/event_placeholder.jpg'")
            if started()
              - timerDate = data.end;
              p Ending in
            else
              - timerDate = data.start;
              p Starting in
            h5#cd --
            hr.d-md-none
          div.col-12.col-md-8
            form#calculator
              div.form-row
                div.form-group.col-12.col-md-4
                  label Goal
                  input.form-control(type="number" min=0 name="goal")
                div.form-group.col-12.col-md-4
                  label Current points
                  input.form-control(type="number" min=0 name="currpts")
                div.form-group.col-12.col-md-4
                  label Points per battle
                  input.form-control(type="number" name="ppb" readonly=data.isBirthday min=(data.isBirthday?12:120) value=(data.isBirthday?12:''))
            <ul class="nav nav-tabs" id="resultTab" role="tablist">
              <li class="nav-item" role="presentation">
                <a class="nav-link active" id="daily-tab" data-toggle="tab" href="#daily" role="tab" aria-controls="daily" aria-selected="true">Today</a>
              </li>
              <li class="nav-item" role="presentation">
                <a class="nav-link" id="total-tab" data-toggle="tab" href="#total" role="tab" aria-controls="total" aria-selected="false">Total</a>
              </li>
            </ul>
            div#resultTabContent.tab-content.pt-3
              div#daily.tab-pane.show.active(role="tabpanel" aria-labelledby="daily-tab")
                h5 Result
                div.simple-r.row.text-center
                  div.col-12.col-md-6
                    p Today's goal
                    h5.goal --
                  div.col-12.col-md-6
                    p Required battles
                    h5.dailybattles --
                  div.col-12.col-md-6
                    p Required AP
                    h5.apreq --
                  div.col-12.col-md-6
                    p Required DP
                    h5.dpreq --
                h5 Breakdown
                div#results.row.justify-content-center
                  div.col-12.col-md-6.col-lg-4
                    div.result-container
                      p AP
                      div
                        div
                          span= t("calculator.free")
                          span.freeap --
                        div
                          span= t("calculator.buy")
                          span.buyap --
                        hr
                        div
                          span Total
                          span.aptot --
                  div.col-12.col-md-6.col-lg-4
                    div.result-container
                      p Battles
                      div
                        div
                          span= t("calculator.free")
                          span.freebattles --
                        div
                          span= t("calculator.buy")
                          span.buybattles --
                        hr
                        div
                          span Total
                          span.battlestot 20,000
                  div.col-12.col-md-6.col-lg-4
                    div.result-container
                      p Devil Points
                      div
                        div
                          span AP
                          span.apcost --
                        div
                          span Battles
                          span.battlescost --
                        hr
                        div
                          span Total
                          span.totcost --
              div#total.tab-pane(role="tabpanel" aria-labelledby="total-tab")
                h5 Result
                div.simple-r.row.text-center
                  div.col-12.col-md-6
                    p Goal
                    h5.goal --
                  div.col-12.col-md-6
                    p Required battles
                    h5.dailybattles --
                  div.col-12.col-md-6
                    p Required AP
                    h5.apreq --
                  div.col-12.col-md-6
                    p Required DP
                    h5.dpreq --
                h5 Breakdown
                div#results.row.justify-content-center
                  div.col-12.col-md-6.col-lg-4
                    div.result-container
                      p AP
                      div
                        div
                          span= t("calculator.free")
                          span.freeap --
                        div
                          span= t("calculator.buy")
                          span.buyap --
                        hr
                        div
                          span Total
                          span.aptot --
                  div.col-12.col-md-6.col-lg-4
                    div.result-container
                      p Battles
                      div
                        div
                          span= t("calculator.free")
                          span.freebattles --
                        div
                          span= t("calculator.buy")
                          span.buybattles --
                        hr
                        div
                          span Total
                          span.battlestot 20,000
                  div.col-12.col-md-6.col-lg-4
                    div.result-container
                      p Devil Points
                      div
                        div
                          span AP
                          span.apcost --
                        div
                          span Battles
                          span.battlescost --
                        hr
                        div
                          span Total
                          span.totcost --

      if !started()
        div.w-100.h-100.rounded(style="position:absolute;background:rgba(255,255,255,.8);")
          div.row.w-100.h-100.justify-content-center.align-items-center
            h5 Coming soon.
      if ended()
        div.w-100.h-100.rounded(style="position:absolute;background:rgba(255,255,255,.8);")
          div.row.w-100.h-100.justify-content-center.align-items-center
            h5 This event has ended.
  style.
    .simple-r p {
      margin-bottom: .75rem;
    }
    .simple-r h5 {
      margin-bottom: 1.25rem;
    }
    #results p {
      text-align: center;
    }
    #results .result-container {
      border-radius: 1rem;
      border: 2px solid var(--secondary);
      padding: 1rem 1.5rem;
      margin-bottom: 1rem;
    }
    #results .result-container>div>div {
      display: flex;
      justify-content: space-between;
    }
    #results hr {
      margin: .5rem 0;
      border: 1px solid var(--secondary);
    }

    @media (min-width: 768px) {
      #pqinfo {
        border-right:1px solid #e5e5e5;
      }
    }
    a[data-toggle="collapse"][aria-expanded="false"] .bi.bi-chevron-up {
      transform: rotate(180deg);
    }
